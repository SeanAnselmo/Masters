---
title: 'Sean Anselmo Assignment 2'
output:
  pdf_document:
    latex_engine: xelatex
  word_document: default
  html_notebook: default
  html_document:
    df_print: paged
---

## ASSIGNMENT 2

## First-order Model with Interaction Terms (Quantitative and Qualitative Variable and Model Selection 

*Deadline: March 17 , 2024, by 11:59 pm. Submit to Gradescope.ca*

&copy; Thuntida Ngamkham 2022 Modified by Danika Lipman 2024
```{r, echo = FALSE}
library(olsrr)
library(leaps)
```

**Problem 1**. The file __tires.csv__ provides the results of an experiment on tread wear per 160 km and the driving speed in km/hour. The researchers looked at 2 types of tires and tested 20 random sample tires. The response variable is the tread wear per 160 km in the percentage of tread thickness, and the quantitative predictor is the average speed in km/hour.

```{r, include=T}
tires=read.csv("https://raw.githubusercontent.com/DanikaLipman/DATA603/main/tires.csv", header = TRUE)
str(tires)
```

Answer the following questions

(a) Use the individual T-test to evaluate the significant predictors from the full model at $\alpha=0.05$ and write the estimated best fit model. 

```{r}
```

(b) Based on the output in (a), define the dummy variable that explains the two types of tires.



(c) From the best fit model in part (a), interpret all possible regression coefficient estimates,$\hat{\beta_i}$.


(d) From the best fit model in part (a), you can improve this model by adding an interaction term(s). Evaluate whether the interaction term(s) is(are) significant to be added in the model at $\alpha = 0.05$.  Summarize which model would you suggest using for predicting y. 


(e)  From the model in part (d), report the adjusted-$R^2$ value from the model selected and interpret its value.

(f)  Predict the average tread wear per 160 km in the percentage of tread thickness for a car with type A with the average speed of 100 km/hour from the model selected in part (d) with 95% confidence.

-------------------------------------------------------------------


**Problem 2**. A team of mental health researchers wishes to compare three methods (A, B, and C) of treating severe depression. They would also like to study the relationship between age and treatment effectiveness as well as the interaction (if any) between age and treatment.

Each member of a simple random sample of 36 patients, comparable with respect to diagnosis and severity of depression, was randomly assigned to receive treatment A, B, or C. The data are given in __MentalHealth.csv__. 

```{r}

```

Answer the following questions

(a) Which is the dependent variable (the response variable)?

(b) What are the independent variables (the predictors)?

(c) Draw a scatter diagram of the sample data with EFFECT on the y-axis and AGE on the x-axis using different symbols/colors for each of the three treatments. Briefly summarize the visualization. [Hint: Check MLR part II under Interaction Effect in MLR with both Quantitative and Qualitative Variable models].


(d) Is there any interaction between age and treatment? Test the hypothesis at $\alpha=0.05$.

(e) From part (d), write the final model with sub-models for predicting the treatment effectiveness. Please ensure you substitute all regression coefficients to the models.


(f) Interpret the effect of treatment from sub-models in part (e). 


(g) Plot the three regression lines on the scatter diagram obtained in part (c). May one have the same conclusion as in part (f)?

----------------------------------------------------------


**Problem 3**. __Collusive bidding in road construction__. Road construction contracts in the state of Florida are awarded on the basis of competitive, sealed bids; the contractor who submits the lowest bid price wins the contract. During the 1980s, the Office of the Florida Attorney General (FLAG) suspected numerous contractors of practicing bid collusion (i.e., setting the winning bid price above the fair, or competitive, price in order to increase proect margin). By comparing the bid prices (and other important bid variables) of the fixed (or rigged) contracts to the competitively bid contracts, FLAG was able to establish invaluable benchmarks for detecting future bid-rigging. FLAG collected data for 279 road construction contracts. For each contract, the following variables shown below were measured and are **only** considered for this problem. 

1. Price of contract ($) bid by lowest bidder, LOWBID.

2. Department of Transportation (DOT) engineer's estimate of fair contract price ($), DOTEST.

3. Status of contract (1 if fixed, 0 if competitive), STATUS	

4. District (1, 2, 3, 4, or 5) in which the construction project is located, DISTRICT.

5. Number of bidders on contract, NUMIDS.

6. Estimated number of days to complete work, DAYSEST.

7. Length of road project (miles), RDLNGTH.

8. Percentage of costs allocated to liquid asphalt, PCTASPH.

9. Percentage of costs allocated to base material, PCTBASE.

10. Percentage of costs allocated to excavation, PCTEXCAV.

11. Percentage of costs allocated to mobilization, PCTMOBIL.

12. Percentage of costs allocated to structures, PCTSTRUC.

13. Percentage of costs allocated to traffic control, PCTTRAF.

```{r}
FLAG2 <- read.delim("~/603/Ass2/FLAG2.txt")
library(olsrr)
library(leaps)
```

The data are saved in the file named __FLAG2.txt__. Answer the following questions:

(a) Consider building a model for the low-bid price (Y). Apply __Stepwise Regression Procedure with p_enter=0.05 and p_remove=0.1__ to the data to find the independent variables most suitable for modeling $Y$. 

```{r}
fullmodelFLAG = lm(LOWBID~ DOTEST+STATUS+DISTRICT+NUMIDS+DAYSEST+RDLNGTH+PCTASPH+PCTBASE+PCTTRAF+PCTSTRUC+PCTMOBIL ,data=FLAG2)

StepWiseFLAG1=ols_step_both_p(fullmodelFLAG,p_enter = 0.05, p_remove = 0.1, details=TRUE)
```
**ANSWER TO Q3a** The significant independant variables found from the stepwise selection method are:

Department of Transportation (DOT) engineer's estimate of fair contract price ($), DOTEST.
Status of contract (1 if fixed, 0 if competitive), STATUS	
Number of bidders on contract, NUMIDS.

The model would be:

$$LOWBIDS=\beta_0+\beta_1DOTEST+\beta_2STATUS+\beta_3NUMIDS$$

(b) Consider building a model for the low-bid price (Y). Apply __Forward Regression Procedure with p_val=0.05__ :*ols_step_forward_p(fullmodel,p_val=0.05)* to the data to find the independent variables most suitable for modeling Y.  
```{r}
StepWiseFLAG2=ols_step_forward_p(fullmodelFLAG,p_val=0.05, details=TRUE)
```
**ANSWER TO Q3b** The significant independant variables found from the forward selection are:

Department of Transportation (DOT) engineer's estimate of fair contract price ($), DOTEST.
Status of contract (1 if fixed, 0 if competitive), STATUS	
Number of bidders on contract, NUMIDS.

The model would be:

$LOWBIDS=\beta_0+\beta_1DOTEST+\beta_2STATUS+\beta_3NUMIDS$

(c) Consider building a model for the low-bid price (Y). Apply __Backward Regression Procedure with p_val=0.05__ :*ols_step_backward_p(fullmodel,p_val=0.05)* to the data to find the independent variables most suitable for modeling Y.  
```{r}
StepWiseFLAG3=ols_step_backward_p(fullmodelFLAG,p_val=0.05, details=TRUE)
```
**ANSWER TO Q3c** The significant independant variables found from the backward selection are:

Department of Transportation (DOT) engineer's estimate of fair contract price ($), DOTEST.
Status of contract (1 if fixed, 0 if competitive), STATUS	
Number of bidders on contract, NUMIDS.

The model would be:

$LOWBIDS=\beta_0+\beta_1DOTEST+\beta_2STATUS+\beta_3NUMIDS$

All the models created from the bothway selection, forward, and backward are using the same significant predictors.

(d) Test the individual t-test at $\alpha=0.05$ to evaluate the variables in the full model. What predictors should be kept in the model based on the individual t-tests from the full model?
```{r}
fullmodelFLAG = lm(LOWBID~ DOTEST+factor(STATUS)+factor(DISTRICT)+NUMIDS+DAYSEST+RDLNGTH+PCTASPH+PCTBASE+PCTTRAF+PCTSTRUC+PCTMOBIL ,data=FLAG2)
summary(fullmodelFLAG)
```
**ANSWER TO Q3d** The significant independent variables found from the individual t-test at $\alpha=0.05$ are:

Department of Transportation (DOT) engineer's estimate of fair contract price ($), DOTEST.
Status of contract (1 if fixed, 0 if competitive), STATUS	
District (1, 2, 3, 4, or 5) in which the construction project is located, DISTRICT.
Number of bidders on contract, NUMIDS.

The model would be:

$LOWBIDS=\beta_0+\beta_1DOTEST+\beta_2STATUS+\beta_3DISTRICT+\beta_4NUMIDS$

The individual t test examination at $\alpha=0.05$ yielded the same significant predictors as the stepwise selection procedure, with the DISTRICT factor predictor included as well.  

(e) Compare the results, parts (a)-(d). Which independent variables consistently are selected as the ''best'' predictors for the model? Write all possible additive model(s) for predicting $Y$. Note! Proposing more than one model is acceptable.

**ANSWER TO Q3e** The independent variables that are consistently selected are:

Department of Transportation (DOT) engineer's estimate of fair contract price ($), DOTEST.
Status of contract (1 if fixed, 0 if competitive), STATUS	
Number of bidders on contract, NUMIDS.

Possible additive models could be:

$LOWBIDS=\beta_0+\beta_1DOTEST+\beta_2STATUS+\beta_3NUMIDS$
$LOWBIDS=\beta_0+\beta_1DOTEST+\beta_2STATUS+\beta_3NUMIDS+\beta_4DISTRICT$

(f) Assume that your model selected in part (e) contains the following predictors: DOTEST,STATUS,NUMBIDS, and DISTRICT. Calculate the absolute difference in average contact bid price (by the lowest bidder) between District 1 and 4,when other predictors are held as a constant.
```{r}
partmodelFLAG = lm(LOWBID~ DOTEST+factor(STATUS)+factor(DISTRICT)+NUMIDS ,data=FLAG2)
summary(partmodelFLAG)
```
**ANSWER TO Q3f** To find the absolute difference in price between District 1 and District 4 while everything else is held constant, we have to look at the $\beta$ values. Specifically, we look at the $\beta_0$ value for District 1, and the $\beta_5$ value associated with District 4.

$\beta_0$ = 6.05x10^4
$\beta_5$ = -3.165x10^5

Absolute Difference = District 4 - District 1

Absolute Difference = (−3.165×10 + $\beta_0$)- $\beta_0$

Absolute Difference = 3.165x10^5

The absolute difference in price between District 1 and District 4 is $316,500 less for District 4.

 
(g) Assume that your model selected in part (e) contains the following predictors: DOTEST,STATUS,NUMBIDS, and DISTRICT. Calculate the difference in average contact bid price (by the lowest bidder) between District 2 and 5,when other predictors are held as a constant.

**ANSWER TO Q3g** To find the absolute difference in price between District 2 and District 5 while everything else is held constant, we have to look at the $\beta$ values. Specifically, we look at the $\beta_3$ value for District 1, and the $\beta_6$ value associated with District 4.

$\beta_3$ = 6.05x10^4
$\beta_6$ = -3.165x10^5

Absolute Difference = District 5 - District 2

Absolute Difference = (7.100e+04 + $\beta_0$)- (-1.415e+04 + $\beta_0$)

Absolute Difference = 7.100e+04 + 1.415e+04

The absolute difference in price between District 2 and District 5 is $85,150 less for District 5.


(h) Assume that your model selected in part (e) contains the following predictors: DOTEST,STATUS,NUMBIDS, and DISTRICT. Build the first order model with interaction terms. Write the best fit model for predicting $Y$.

```{r}
firstOrder = lm(LOWBID~ DOTEST+factor(STATUS)+factor(DISTRICT)+NUMIDS ,data=FLAG2)
firstOrderint = lm(LOWBID~ (DOTEST+factor(STATUS)+factor(DISTRICT)+NUMIDS)^2 ,data=FLAG2)
summary(firstOrderint)

firstOrderintFinal = lm(LOWBID ~ DOTEST+factor(STATUS)+factor(DISTRICT)+NUMIDS+DOTEST:factor(STATUS)+DOTEST:factor(DISTRICT)+DOTEST:NUMIDS+NUMIDS:factor(DISTRICT), data=FLAG2)
summary(firstOrderintFinal)


interactive = regsubsets(LOWBID ~ DOTEST+factor(STATUS)+factor(DISTRICT)+NUMIDS, data = FLAG2, nv=10)
summary(interactive)

reg.summary=summary(interactive)
rsquare=c(reg.summary$rsq)
cp=c(reg.summary$cp)
AdjustedR=c(reg.summary$adjr2)
RSS=c(reg.summary$rss)
BIC=c(reg.summary$bic)
cbind(rsquare,cp,BIC,RSS,AdjustedR)
```

**ANSWER FOR Q3 h** The best fit model for predicting Y includes interaction terms:

$Y=\beta_0+\beta_1DOTEST+\beta_2STATUS+\beta_3NUMIDS+\beta_4DISTRICT+\beta_1\beta_2DOTEST*STATUS+\beta_1\beta_4DOTEST*DISTRICT+\beta_1\beta_3DOTEST*NUMIDS+\beta_3\beta_4NUMIDS*DISTRICT$


(i) Compare the RSE from the first-order model in part (d) with the interaction model in part (h). Interpret the result. 

**ANSWER FOR Q3 i** The RSE from the interactive model is 251400, and the RSE from the additive model is 279700. The RSE for the interactive model is lower, which indicates the interactive model makes esitamtes that more closely fit the actual data.

The interactive model having a lower RSE than the additive indicates it is the better fit model.

(j)  Find the $R^2_{adj}$ and interpret the result from part (h).

**ANSWER FOR Q3 j** The $R^2_{adj}$ from the interactive model is 0.981, and the $R^2_{adj}$ from the additive model is 0.9765. This means for our interactive model, 98.1% of the variance is explained by the model, whereas in the additive model only 97.65% of the variance is explained by the model.

The interactive model having a higher $R^2_{adj}$ than the additive indicates it is the better fit model.


--------------------------------------------------------------


**Problem 4:**  An author studied family caregiving in Korea of older adults with dementia. The outcome variable, caregiver burden (BURDEN), was measured by the Korean Burden Inventory (KBI) where scores ranged from 28 to 140 with higher scores indicating higher burden. The following independent variables were reported by the researchers:

1. CGAGE: caregiver age (years)
2. CGINCOME: caregiver income (Won-Korean currency)
3. CGDUR: caregiver-duration of caregiving (month)
4. ADL: total activities of daily living where low scores indicate the elderly perform activities
independently.
5. MEM: memory and behavioral problems with higher scores indicating more problems.
6. COG: cognitive impairment with lower scores indicating a greater degree of cognitive impairment.
7. SOCIALSU: total score of perceived social support (25-175, higher values indicating more
support). The reported data are in the file __KBI.csv__.

Answer the following questions:

```{r}
KBI <- read.csv("~/603/Ass2/KBI.csv")
```

(a) Use stepwise regression (with stepwise selection) to find the ''best'' set of predictors of caregiver burden. Report all significant predictors. __[Hint: Use p_enter =0.1 and p_remove=0.3].__

```{r}
library(olsrr)

#First is stepwise
fullmodel = lm(BURDEN~CGAGE+CGINCOME+CGDUR+ADL+MEM+COG+SOCIALSU, data = KBI)
StepWise=ols_step_both_p(fullmodel,p_enter = 0.1, p_remove = 0.3, details=TRUE)

```

**Answer to Question 4 a**
Our stepwise regression with stepwise selection has yielded significant predictors in:

1. MEM (Memory)
2. SOCIALSU (Social support)
3. CGDUR (Caregiver duration)

The best set of predictors are: MEM+SOCIALSU+CGDUR. This model has an Adjusted $R^2$ equal to 0.422. This model has an AIC of 834.570.

(b) Use all-possible-regressions-selection to find the ''best'' predictors of caregiver burden. Which model would you pick based on AIC? Adjusted $R^2$? Report all significant predictors.

```{r}
#All Possible Selection
AllPossible=ols_step_all_possible(fullmodel,p_enter = 0.1, p_remove = 0.3, details=TRUE)

min_adjr <- min(AllPossible$result$adjr)
model_with_min_adjr <- AllPossible$result[AllPossible$result$adjr == min_adjr, ]

min_aic <- min(AllPossible$result$aic)
model_with_min_aic <- AllPossible$result[AllPossible$result$aic == min_aic, ]


```
**Answer to Question 4 b**
The significant predictors and model based on Adjusted $R^2$:

1. MEM (Memory)
2. SOCIALSU (Social support)
3. CGDUR (Caregiver duration)
4. ADL (Total Daily Living Activities)

The all possible selection based on Adjusted $R^2$ chose the significant predictors of MEM+SOCIALSU+CGDUR+ADL.This model has an Adjusted $R^2$ equal to 0.424063346 This selection included ADL (Daily Living Activities) that was not included in the stepwise selection method.

The significant predictors and model based on AIC:

1. MEM (Memory)
2. SOCIALSU (Social support)
3. CGDUR (Caregiver duration)

This all possible selection based on AIC chose the significant predictors of MEM+SOCIALSU+CGDUR.The AIC for this model is 834.5703. This selection method found the same significant predictors than the stepwise selection method.


(c) Compare the results, parts a-b. Which independent variables consistently are selected as the ''best'' predictors?  Build the first order model with interaction terms based on these predictors, evaluate which interaction terms are significant to be added in the model, and conclude the the final model for the prediction.

```{r}
intmodel1 = lm(BURDEN~CGDUR+MEM+SOCIALSU+MEM:SOCIALSU, data = KBI)
summary(intmodel1)

intmodel2 = lm(BURDEN~CGDUR+MEM+SOCIALSU+MEM:CGDUR, data = KBI)
summary(intmodel2)

intmodel3 = lm(BURDEN~CGDUR+MEM+SOCIALSU+SOCIALSU:CGDUR, data = KBI)
summary(intmodel3)
```

**Answer to Question 4 c** The independent variables that are consistently selected are MEM, SOCIALSU, and CGDUR. The Adjusted $R^2$ selection method also yielded ADL. The model created by the stepwise selection is the model of choice and will be proceeding with this one for interaction terms. The lowest AIC score model also agreed with the stepwise selection method.

Based on the interaction models, no interaction terms based on the selected predictors are significant. The final mode is:

Burden = MEM + SOCIALSU + CGDUR

-----------------------------------------------------
